<html>
	<head>
		<title>Track a Workout</title>
		<link rel="stylesheet" href="css/workoutStyle.css" />
		<link rel="stylesheet" href="css/sharedStyle.css" />
		<link rel="stylesheet" href="./css/sharedStyle.css" />
		<!-- <link rel="stylesheet" href="css/dashboardStyle.css"> -->
	</head>
	<body>
		<header class="topBar">
			<div>
				<img src="images/activ8logo.png" />
				<h1>Activ8</h1>
			</div>
			<div class="rightButts">
				<a href="dashboard.html" class="profileButt">
					<img src="images/userIcon.png" />
				</a>
				<!-- <a href="login.html" class="logoutButt">Logout</a> -->
				<button class="logoutButt" onclick="window.location.href='index.html'">Logout</button>
			</div>
		</header>

		<div class="navBar">
			<a href="./dashboard.html" class="navbar-link">Dashboard</a>
			<a href="./mealTracking.html" class="navbar-link">Track a Meal</a>
			<a href="./workout.html" class="navbar-link selected">Track a Workout</a>
			<a href="./community.html" class="navbar-link">Community Page</a>
			<a href="./createPost.html" class="navbar-link">Create a Post</a>
		</div>

		<div class="workoutHeading">
			<h2>Dashboard >> Track a Workout</h2>
		</div>
		<label class="dateLabel"> </label>
		<div class="searchContainer">
			<!-- <label class="dateLabel"> </label> -->
			<div class="searchBar">
				<img src="images/magnifyingGlass.png" />
				<input type="text" id="searchInput" placeholder="Search an exercise to add to workout" />
				<div id="exerciseSearch" class="exerciseSearch"></div>

			</div>
		</div>

		<div class="outerFieldsContainer">
		<div class="fieldsContainer">
			<div class="leftFields">
			</div>
			<div class = "rightFields">
				<div class="rightExerciseContainer"> </div>
				<div class="commentContainer">
					<label class="commentLabel">Personal Comment:</label>
				<textarea type = text class="commentBox" placeholder="Write your personal comment"> </textarea>
					
       		</div>
			</div>
		</div>


		</div>
		<button class="submitBtn" onclick="window.location.href='dashboard.html'">submit</button>
		<!-- <img class="menuBtn" src="images/MenuButtLabelled.png" > -->
		<script id="exerciseData" type="application/json">
			{
				"exercises": [
					{"id": 1, "name": "squat", "type": "resistance training"},
					{"id": 2, "name": "dumbell squat", "type": "resistance training"},
					{"id": 3, "name": "pull-up", "type": "resistance training"},
					{"id": 4, "name": "pushup", "type": "resistance training"},
					{"id": 5, "name": "run", "type": "cardiovsascular training"},
					{"id": 5, "name": "walk", "type": "cardiovsascular training"},
					{"id": 6, "name": "bike", "type": "cardiovsascular training"},
					{"id": 7, "name": "bench press", "type": "resistance training"},
					{"id": 8, "name": "seated shoulder press", "type": "resistance training"},
					{"id": 9, "name": "swim", "type": "cardiovsascular training"},
					{"id": 10, "name": "bicep curl", "type": "resistance training"},
					{"id": 11, "name": "tricep extension", "type": "resistance training"},
					{"id": 12, "name": "seated row", "type": "resistance training"},
					{"id": 13, "name": "walking lunges", "type": "resistance training"}
				]
			}
		</script>
		<script>
			// Parse JSON embedded in the HTML
			const exerciseJSON = document.getElementById('exerciseData').textContent;
			const exercises = JSON.parse(exerciseJSON).exercises;

			const exerciseInput = document.getElementById('searchInput');
			const exerciseSearch = document.getElementById('exerciseSearch');
			const leftFields = document.querySelector('.leftFields');
			const rightExerciseContainer = document.querySelector('.rightExerciseContainer'); // new reference


			// Clear placeholder when user clicks on the box (focus)
			exerciseInput.addEventListener('focus', () => {
				exerciseInput.placeholder = '';
				// If thereâ€™s text already typed, re-show the box
				if (exerciseInput.value.trim() !== '' && exerciseSearch.innerHTML.trim() !== '') {
					exerciseSearch.style.display = 'block';
				}
			});

			// Restore placeholder when they click away and the box is empty (blur)
			exerciseInput.addEventListener('blur', () => {
				if (exerciseInput.value === '') {
					exerciseInput.placeholder = 'Search an exercise to add to workout';
				}
			});

			// Filter and show exercise matches as user types
			exerciseInput.addEventListener('input', () => {
				const query = exerciseInput.value.toLowerCase().trim();

				// If empty search bar, close results box
				if (query === '') {
					exerciseSearch.style.display = 'none';
					exerciseSearch.innerHTML = '';
					return;
				}

				const filtered = exercises.filter((ex) => ex.name.toLowerCase().includes(query));

				displayResults(filtered);
			});

			// Display results dynamically
			function displayResults(results) {
				exerciseSearch.innerHTML = '';

				if (results.length === 0) {
					exerciseSearch.innerHTML = '<p class="noResults">No exercise matches your search</p>';
				} else {
					results.forEach((ex) => {
						const div = document.createElement('div');
						div.classList.add('exerciseResult');
						div.textContent = `${ex.name} (${ex.type})`;

						// When user clicks on an exercise, collapse search
						div.addEventListener('click', () => {
							addExerciseBox(ex.name, ex.type);
							exerciseInput.value = ''; // clear search bar
							exerciseSearch.innerHTML = ''; // hide results
							exerciseSearch.style.display = 'none';
							exerciseInput.placeholder = 'Search an exercise to add to workout';
						});

						exerciseSearch.appendChild(div);
					});
				}
				exerciseSearch.style.display = 'block';
			}

			//  Function to log exercises under search


		let firstExerciseType = null; // Track the first exercise type added

		function addExerciseBox(exerciseName, exerciseType) {
			const wrapper = document.createElement('div');
			wrapper.classList.add('exerciseWrapper'); // contains the box + labels

			const box = document.createElement('div');
			box.classList.add('exerciseBox');
			box.setAttribute('data-name', exerciseName);

			const labelsContainer = document.createElement('div');
			labelsContainer.classList.add('labelsContainer');

			const typeLower = exerciseType.toLowerCase();

			// Determine column placement
			let targetColumn;
			if (!firstExerciseType) {
				// First exercise added
				firstExerciseType = typeLower;
				targetColumn = leftFields; // first type goes to left
			} else {
				// If same type as first, keep in left, else go to right
				targetColumn = (typeLower === firstExerciseType) ? leftFields : rightExerciseContainer;
			}

			if (typeLower.includes('resistance')) {
				for (let i = 1; i <= 3; i++) {
					const setRow = document.createElement('div');
					setRow.classList.add('setRow');

					const setLabel = document.createElement('div');
					setLabel.classList.add('setLabel');
					setLabel.textContent = `Set ${i}`;

					const repsLabel = document.createElement('label');
					repsLabel.textContent = 'Reps';
					repsLabel.classList.add('inputLabel');

					const repsInput = document.createElement('input');
					repsInput.type = 'number';
					repsInput.min = 0;
					repsInput.placeholder = '--';
					repsInput.classList.add('smallInput');

					const weightLabel = document.createElement('label');
					weightLabel.textContent = 'Weight';
					weightLabel.classList.add('inputLabel');

					const weightInput = document.createElement('input');
					weightInput.type = 'number';
					weightInput.min = 0;
					weightInput.placeholder = '--';
					weightInput.classList.add('smallInput');

					const unitLabel = document.createElement('label');
					unitLabel.textContent = 'kg';
					unitLabel.classList.add('inputLabel');

					setRow.appendChild(setLabel);
					setRow.appendChild(repsLabel);
					setRow.appendChild(repsInput);
					setRow.appendChild(weightLabel);
					setRow.appendChild(weightInput);
					setRow.appendChild(unitLabel);

					labelsContainer.appendChild(setRow);
				}
			} else if (typeLower.includes('cardio')) {
				const labels = ['Distance (km)', 'Time (min)', 'Avg Speed (min/km)'];
				labels.forEach((labelText) => {
					const dataWrapper = document.createElement('div');
					dataWrapper.classList.add('dataWrapper');

					const label = document.createElement('label');
					label.classList.add('cardioLabel');
					label.textContent = labelText;

					const cardioInput = document.createElement('input');
					cardioInput.classList.add('cardioInput');
					cardioInput.type = 'text';
					cardioInput.min = 0;
					cardioInput.placeholder = 'enter value';

					dataWrapper.appendChild(label);
					dataWrapper.appendChild(cardioInput);

					labelsContainer.appendChild(dataWrapper);
				});
			}

			wrapper.appendChild(box);
			wrapper.appendChild(labelsContainer);
			targetColumn.appendChild(wrapper); // append to left or right column
		}

			// Hide results when clicking outside
			document.addEventListener('click', (event) => {
				const isClickInside = exerciseInput.contains(event.target) || exerciseSearch.contains(event.target);
				if (!isClickInside) {
					exerciseSearch.style.display = 'none';
				}
			});
			// --- Display today's date ---
			const dateLabel = document.querySelector('.dateLabel');
			const today = new Date();

			const formattedDate = today.toLocaleDateString('en-US', {
			year: 'numeric',
			month: 'long',
			day: 'numeric'
			});
  			dateLabel.textContent = `Today's workout: ${formattedDate}`;
		</script>
	</body>
</html>
